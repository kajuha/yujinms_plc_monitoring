<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Recipelab - AMR Dashboard V0.1</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- App favicon -->
        <link rel="shortcut icon" href="static/images/favicon.ico">

        <!-- App css -->
        <link href="static/css/icons.min.css" rel="stylesheet" type="text/css" />
        <link href="static/css/app.min.css" rel="stylesheet" type="text/css" />
    </head>

    <body data-layout="topnav">

        <!-- Begin page -->
        <div class="wrapper">

            <!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->

            <div class="content-page">
                <div class="content">

                    <!-- Topbar Start -->
                    <div class="navbar-custom topnav-navbar">
                        <div class="container-fluid">
                            <a href="index.html" class="topnav-logo">
                                <span class="topnav-logo-lg">
                                    <img src="static/images/logo-dark.png" alt="" height="20">
                                </span>
                                <span class="topnav-logo-sm">
                                    <img src="static/images/logo_sm.png" alt="" height="20">
                                </span>
                            </a>
                            </ul>
                            <a class="navbar-toggle"  data-toggle="collapse" data-target="#topnav-menu-content">
                                <div class="lines">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </a>
                        </div>
                    </div>
                    <!-- end Topbar -->

                    <div class="topnav">
                        <div class="container-fluid">
                            <nav class="navbar navbar-dark navbar-expand-lg topnav-menu">
        
                                <div class="collapse navbar-collapse" id="topnav-menu-content">
                                    <ul class="navbar-nav">
                                        <li class="nav-item">
                                            <a href="index.html" class="nav-link">
                                                <i class="mdi mdi-speedometer mr-1"></i>AMR Dashboard
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="pages-positiontable.html" class="nav-link">
                                                <i class="mdi mdi-speedometer mr-1"></i>Position Table
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </nav>
                        </div>
                    </div>


                    <!-- Start Content-->
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row pb-3">
                        </div>
                        <!-- end page title -->

                        <div class="row">

                            <div class="col-xl-6 text-center">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mb-3">Odometry</h4>

                                        <div class="row text-center">

                                            <div class="col-sm-4">
                                                <div class="card widget-flat">
                                                    <div class="card-body">
                                                        <h5 class="text-muted font-weight-normal mt-0">X(m)</h5>
                                                        <h3 id="simpleOdomLX" class="mt-1 mb-1">-</h3>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-4">
                                                <div class="card widget-flat">
                                                    <div class="card-body">
                                                        <h5 class="text-muted font-weight-normal mt-0">Y(m)</h5>
                                                        <h3 id="simpleOdomLY" class="mt-1 mb-1">-</h3>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-4">
                                                <div class="card widget-flat">
                                                    <div class="card-body">
                                                        <h5 class="text-muted font-weight-normal mt-0">Z(&deg)</h5>
                                                        <h3 id="simpleOdomTZ" class="mt-1 mb-1">-</h3>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-6 text-center">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mb-3">Platform</h4>

                                        <div class="row text-center">

                                            <div class="col-sm-4">
                                                <div class="card widget-flat">
                                                    <div class="card-body">
                                                        <h5 class="text-muted font-weight-normal mt-0">Mode</h5>
                                                        <h3 id="simplePlatformMode" class="mt-1 mb-1">-</h3>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-4">
                                                <div class="card widget-flat">
                                                    <div class="card-body">
                                                        <h5 class="text-muted font-weight-normal mt-0">State</h5>
                                                        <h3 id="simplePlatformState" class="mt-1 mb-1">-</h3>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-4">
                                                <div class="card widget-flat">
                                                    <div class="card-body">
                                                        <h5 class="text-muted font-weight-normal mt-0">Connect?</h5>
                                                        <h3 id="simplePlatformComm" class="mt-1 mb-1 text-uppercase text-danger">-</h3>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">

                            <div class="col-xl-12 text-center">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mb-3">Position Table Control</h4>

                                        <div class="row text-center">
                                            <div class="col-lg-12">
                                                <div class="card widget-flat">
                                                    <div class="card-body">
                                                        <form id="positionTableOrder">
                                                            <div class="form-row">
                                                                <div class="form-group mb-0 col-sm-6">
                                                                    <label for="ptOrder">Order</label>
                                                                    <input type="text" id="ptOrder" name="ptOrder" class="form-control text-center">
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label for="ptSendButton" class="text-transparent">Send</label>
                                                                    <button type="button" id="ptSendButton" class="btn btn-success btn-rounded col-sm-11 text-uppercase">Send</button>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label for="ptStopButton">Stop</label>
                                                                    <button type="button" id="ptStopButton" class="btn btn-outline-danger btn-rounded col-sm-11 text-uppercase">Stop</button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">

                            <div class="col-xl-12 text-center">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mb-3">Position Table</h4>

                                        <!-- <div class="row text-center"> -->
                                            <div class="col-lg-12">
                                                <div class="row">
                                                    <div class="card widget-flat col-md-12">
                                                        <div id="postables_div">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <!-- </div> -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>

                </div>

                <!-- Footer Start -->
                <footer class="footer">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-12">
                                2022 © RecipeLab
                            </div>
                        </div>
                    </div>
                </footer>
                <!-- end Footer -->

            </div>

            <!-- ============================================================== -->
            <!-- End Page content -->
            <!-- ============================================================== -->


        </div>
        <!-- END wrapper -->


        <!-- App js -->
        <!-- app.min.js에 jquery-3.3.1이 임베딩되어 있음 -->
        <script src="static/js/app.min.js"></script>
        <!-- 뒤에 최신 jquery를 추가하면 최신버전으로 로딩됨 -->
        <script src="static/js/jquery-3.6.0.min.js"></script>

        <!-- pallete platform state & graph start -->
        <script src="static/js/highcharts/highcharts.js"></script>
        <script src="static/js/highcharts/data.js"></script>
        <script src="static/js/highcharts/exporting.js"></script>
        <script>
            getPlatformStatus();
            // 데이터 수신주기(200ms)
            setInterval(getPlatformStatus, 200);
            function getPlatformStatus() {
                $.ajax({
                    url: '/post/getPlatformStatus',
                    type: 'POST',
                    success: function (args) {
                        var data = JSON.parse(args);
                        console.log(data);
                        if (data.error == false) {
                            document.getElementById('simpleOdomLX').innerHTML = data.message.odom.linear.x;
                            document.getElementById('simpleOdomLY').innerHTML = data.message.odom.linear.y;
                            document.getElementById('simpleOdomTZ').innerHTML = data.message.odom.twist.z;
                            document.getElementById('simplePlatformMode').innerHTML = data.message.platform.mode;
                            document.getElementById('simplePlatformState').innerHTML = data.message.platform.state;
                            document.getElementById('simplePlatformComm').innerHTML = 'on';    // 통신이 안되면 NO, 되는데 이상하면 ERR
                            $('#simplePlatformComm').removeClass('text-danger');
                            $('#simplePlatformComm').addClass('text-success');
                        } else {
                            // document.getElementById('simpleOdomLX').innerHTML = data.message.odom.linear.x;
                            // document.getElementById('simpleOdomLY').innerHTML = data.message.odom.linear.y;
                            // document.getElementById('simpleOdomTZ').innerHTML = data.message.odom.twist.z;
                            // document.getElementById('simplePlatformMode').innerHTML = data.message.platform.mode;
                            // document.getElementById('simplePlatformState').innerHTML = data.message.platform.state;
                            document.getElementById('simplePlatformComm').innerHTML = 'err';    // 통신이 안되면 NO, 되는데 이상하면 ERR
                            $('#simplePlatformComm').removeClass('text-danger');
                            $('#simplePlatformComm').addClass('text-success');
                        }
                    },
                    error: function (args) {
                        document.getElementById('simplePlatformComm').innerHTML = 'no';    // 통신이 안되면 NO, 되는데 이상하면 ERR
                        $('#simplePlatformComm').removeClass('text-success');
                        $('#simplePlatformComm').addClass('text-danger');
                    }
                });
            }
        </script>
        <!-- pallete platform state & graph end -->

        <!-- platform control start -->
        <script>
            let postables = [
                'postable0',
                'postable1',
                'postable2',
                'postable3',
                'postable4',
                'postable5',
                'postable6',
                'postable7',
                'postable8',
                'postable9',
                'postable10',
                'postable11',
                'postable12',
                'postable13',
                'postable14'
            ];

            makePosTable();
            initControl();

            function makePosTable() {
                let postableHtml = "\
                    <form id='%postable%'>\
                        <div class='row'>\
                            <div class='col-md-4'>\
                                <div class='row'>\
                                    <div class='card-body col-md-5'>\
                                        <h6 class='header-title mb-0'>Control</h6>\
                                        <div class='form-row'>\
                                            <div class='form-group mb-0 col-sm-6'>\
                                                <label for='pt_num'>num</label>\
                                                <input type='text' id='pt_num' name='pt_num' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                            <div class='form-group mb-0 col-sm-6'>\
                                                <label for='pt_type'>type</label>\
                                                <input type='text' id='pt_type' name='pt_type' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                        </div>\
                                    </div>\
                                    <div class='card-body col-md-7'>\
                                        <h6 class='header-title mb-0'>Pose</h6>\
                                        <div class='form-row'>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_x'>X(m)</label>\
                                                <input type='text' id='pt_x' name='pt_x' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_y'>Y(m)</label>\
                                                <input type='text' id='pt_y' name='pt_y' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_z'>Z(&deg)</label>\
                                                <input type='text' id='pt_z' name='pt_z' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                        </div>\
                                    </div>\
                                </div>\
                            </div>\
                            <div class='col-md-8'>\
                                <div class='row'>\
                                    <div class='card-body col-md-4'>\
                                        <h6 class='header-title mb-0'>Velocity</h6>\
                                        <div class='form-row'>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_xvel'>X(m/s)</label>\
                                                <input type='text' id='pt_xvel' name='pt_xvel' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_yvel'>Y(m/s)</label>\
                                                <input type='text' id='pt_yvel' name='pt_yvel' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_zvel'>Z(&deg/s)</label>\
                                                <input type='text' id='pt_zvel' name='pt_zvel' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                        </div>\
                                    </div>\
                                    <div class='card-body col-md-4'>\
                                        <h6 class='header-title mb-0'>Acceleration</h6>\
                                        <div class='form-row'>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_xacc'>X(m/s&sup2)</label>\
                                                <input type='text' id='pt_xacc' name='pt_xacc' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_yacc'>Y(m/s&sup2)</label>\
                                                <input type='text' id='pt_yacc' name='pt_yacc' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_zacc'>Z(&deg/s&sup2)</label>\
                                                <input type='text' id='pt_zacc' name='pt_zacc' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                        </div>\
                                    </div>\
                                    <div class='card-body col-md-4'>\
                                        <h6 class='header-title mb-0'>Max Velocity</h6>\
                                        <div class='form-row'>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_xmax'>X(m/s)</label>\
                                                <input type='text' id='pt_xmax' name='pt_xmax' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_ymax'>Y(m/s)</label>\
                                                <input type='text' id='pt_ymax' name='pt_ymax' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                            <div class='form-group mb-0 col-sm-4'>\
                                                <label for='pt_zmax'>Z(&deg/s)</label>\
                                                <input type='text' id='pt_zmax' name='pt_zmax' class='form-control text-center' style='padding: 0;'>\
                                            </div>\
                                        </div>\
                                    </div>\
                                </div>\
                            </div>\
                        </div>\
                    </form>\
                ";

                let number = 0;
                let type = 0;

                let postablesHtml = "";
                for (var postable of postables) {
                    postablesHtml += postableHtml.replace("%postable%", postable);
                }
                
                document.getElementById('postables_div').innerHTML = postablesHtml;

                for (var postable of postables) {
                    document.querySelector('#' + postable + ' #pt_num').value = number++;
                    document.querySelector('#' + postable + ' #pt_type').value = type;
                    
                    document.querySelector('#' + postable + ' #pt_x').value = 0;
                    document.querySelector('#' + postable + ' #pt_y').value = 0;
                    document.querySelector('#' + postable + ' #pt_z').value = 0;
                    
                    document.querySelector('#' + postable + ' #pt_xvel').value = 0.2;
                    document.querySelector('#' + postable + ' #pt_yvel').value = 0.2;
                    document.querySelector('#' + postable + ' #pt_zvel').value = 10.0;
                    
                    document.querySelector('#' + postable + ' #pt_xacc').value = 0.1;
                    document.querySelector('#' + postable + ' #pt_yacc').value = 0.1;
                    document.querySelector('#' + postable + ' #pt_zacc').value = 5.0;
                    
                    document.querySelector('#' + postable + ' #pt_xmax').value = 0.2;
                    document.querySelector('#' + postable + ' #pt_ymax').value = 0.2;
                    document.querySelector('#' + postable + ' #pt_zmax').value = 10.0;
                }
            }

            function initControl() {
                $('#ptStopButton').click(
                    function () {
                        $.ajax({
                            url: '/post/ptStopButton',
                            type: 'POST',
                            data: $('#positionTableOrder').serialize(),
                            success: function (args) {
                                var data = JSON.parse(args);
                                if (data.error == true) {
                                    console.log(data.message);
                                    // alert(data.message);
                                } else {
                                    // console.log('ptStopButton success');
                                    // alert('ptStopButton success');
                                }
                            },
                            error: function (args) {
                                console.log('ptStopButton fail');
                                // alert('ptStopButton fail');
                            }
                        });
                    }
                );

                $('#ptSendButton').click(
                    function () {
                        postables;
                        let serializeList = "";
                        for (let i=0; i<postables.length; i++) {
                            serializeList += ("#" + postables[i]);
                            if (i+1 != postables.length) {
                                serializeList += ", ";
                            }
                        }
                        // alert($("#positionTableOrder,"+serializeList).serialize());
                        $.ajax({
                            url: '/post/ptSendButton',
                            type: 'POST',
                            data: $("#positionTableOrder,"+serializeList).serialize(),
                            success: function (args) {
                                var data = JSON.parse(args);
                                if (data.error == true) {
                                    console.log(data.message);
                                    alert(data.message);
                                } else {
                                    // console.log('ptSendButton success');
                                    // alert('ptSendButton success');
                                }
                            },
                            error: function (args) {
                                console.log('ptSendButton fail');
                                // alert('ptSendButton fail');
                            }
                        });

                    }
                );
            }
        </script>
        <!-- platform control end -->
    </body>
</html>
